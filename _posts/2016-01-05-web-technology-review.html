---
layout: post
status: publish
published: true
title: 扯扯这些年的技术
author:
  display_name: wordpress
  login: wordpress
  email: pjsong3101@163.com
  url: ''
author_login: wordpress
author_email: pjsong3101@163.com
wordpress_id: 132
wordpress_url: http://oursmedia.net/wordpress/?p=132
date: '2016-01-05 11:35:46 +0000'
date_gmt: '2016-01-05 03:35:46 +0000'
categories:
- 实施笔记
tags: []
comments: []
---
<p>过去一个软件，从开工到消亡，要说时间也可以很长。但是一个趋势，随着时间推移，这个新出生的软件一定是逐渐与世界越来越远。如同老年人，首先是没有人关心，接下来没有人使用，然后便消失了。</p>
<p>怎么办呢？一个办法，我把这个产品打散，分解成一个一个的服务，全身皆可移植。比如我牙齿掉了，我只要造一个牙齿就行了。这样我就永远年轻。</p>
<p>还有一个问题，软件的处理能力。以前我只能挑50斤重的担子，现在别人都能挑100斤，没人喜欢我了。一样的功能，只是要求更高的处理能力，怎么办？通过移植的方式显然没有意义。因为全身器官都要重造。</p>
<p>以上两个比方，是要说软件面临的挑战，一个是软件的服务化，一个是服务的可伸缩性。</p>
<p>有人听了，说好主意，我听你的，你给我弄成这个样子。可是弄来弄去，最后的结果一看，怎么还是那个叼样没啥区别，成本还是非常高，跟新弄一个差不多阿。</p>
<p>这里面我想到两个原因，1，是否真的需要产品服务化， 2，用什么方式做到什么程度。</p>
<p>1， 一些传统企业(有钱的也是他们)， 外包也好，自己的人也好，嘴上说的都是软件即服务，做出来后跟以前没区别，什么原因呢？ 1，传统企业不是IT企业，不需要做到软件即服务。他只需要满足自己的业务需求 2，不会看结果，因为大家最后的结果看起来是一样的，而领导很多时候是只重视表面的，所谓以结果为导向。</p>
<p>2，什么方式做到什么程度。每个人看问题，都是站在自己的知识背景下去理解。对于传统企业来说，他也会问，我也把服务做到什么粒度？他问这个问题，实际上隐含的主语是&ldquo;我的业务&rdquo;，而不是软件。在他看来，软件为业务服务，除了业务，其他都是次要。而前面两个提到的挑战，却是软件对自身的要求，不是围绕谁的业务来的。</p>
<p>那有没有真正的软件即服务？ 我猜谷歌这方面做得最多最好。当然国内也有，腾讯百度阿里都有，如地图之类，但总没那么丰富。比如google有个recaptcha功能，这样你自己的网站要生成captcha的时候只需要写接口调用和客户端，不用写实现。同时他还有图表功能，以前我还曾经用freechart, 实际上同captcha一样，可以直接用接口调，自己不用写实现。当然这中间有个问题是，谷歌在长城之外。 其实这没有关系，我想说的是，我们应该像他一样写软件。</p>
<p>以后所有的应用，不管内部外部，web化是一定的。接下来聊当下web的语言。</p>
<p>windows&#47;linux对应了web平台架构的两大霸主.net和java。尽管现在还有很多C#,ASP, 但是市场占有率也好，开发人员数量也好，开源项目数量质量也好，我感觉前者已经落后于后者。</p>
<p>java1.0的发布，到今年现在已经20，21岁了。他早期的对手是c,c++,人家的优势是快速，高效，缺点是移植性差。他就因为移植性的问题活下来了。接下来网页的天下，c,c++，先天高贵，显然不合适直接用来做web网页，不过他适合做许多能处理网页的语言，如php，python。这样一来，c,c++跟java就不用急了。java没这个基因去做c做得那些事，c也没有基因像java那样可以多变。</p>
<p>继续说网页的天下。到现在为止，唯一不能取代的语言，最牛叉，也口碑最差，就是javascript了。</p>
<p>他取这个名字，仅仅是因为崇拜java，他跟java的差别，就比如奥巴马崇拜毛泽东，把自己名字取名毛巴马(如果谁恶心谁了就对不起)。你就千万不要尝试找他们的共同祖先。</p>
<p>但是这个javascript，确实无人可替。所有做web的人一定都有学习和使用javascript，大家水平层次不同而已。</p>
<p>听说，google内部使用的三大语言是c++,java,python。我讲到这里，大家应该好理解了。什么是python? 脚本语言总得弄一个，其实python我认为跟C++还是亲一些。为什么没有javascript? 人家不做网页开发。</p>
<p>还有其他语言呢？脚本语言最多，基本上是C++养的，各有用处，我也不懂了。</p>
<p><strong>我想象的产品。<&#47;strong></p>
<p>1，所有的资源都是服务，包括网页。</p>
<p>2，页面上不能直接操作数据，只能通过服务调用实现。</p>
<p>3，后台服务与页面服务器不再捆绑，服务可以接受来自不同主机页面的请求，只要请求合法。</p>
<p>4，后台响应请求的服务不可以直接使用sql，redis，mongodb等各种命令，必须走数据服务层服务调用形式。</p>
<p>5，数据服务层处理数据存取。分库，分表，路由，mongodb，redis，各种策略。</p>
<p>6，有数据，必有缓存。</p>
<p>7，有请求，必有HA，LB。</p>
<p>8，开发，测试，部署全一套环境，直接生成img，部署到docker。</p>
<p><strong>QA：<&#47;strong></p>
<p>Q1，如果为10k个客户，每个页面100k, &nbsp;每秒钟每个客户有2000个请求，将达到10k*100k*2k=2T&#47;秒的带宽，怎么解决。</p>
<p>A1，因为页面已经完全静态化，适用于cdn缓存。<a href="https:&#47;&#47;help.aliyun.com&#47;knowledge_detail&#47;5974827.html">参考<&#47;a>。</p>
<p>Q2，有些场景客户端必须要保存一些数据，比如，我最近玩过的游戏，我上一次浏览的页面，我浏览次数最多的页面，不让写数据库，写到哪里？</p>
<p>A1，html5提供了向用户本地写数据的能力，与业务无关的数据直接写用户磁盘即可。这类数据即使丢失，只是影响用户体验，没有大影响。</p>
<p>Q3，对于第三点，怎样保证安全。</p>
<p>A3，争取客户主机使用https通信，信息加密。</p>
<p>Q4，一个简单的数据库操作还要向上调用2层才能做到，是否太啰嗦。</p>
<p>A4，每一层实际上只和自己的上一层交互，且各层之间是独立的。看起来步骤多，但不影响测试，对于后面扩展和灵活部署是必须的。</p>
<p>&nbsp;</p>
<p><strong>意义：<&#47;strong></p>
<p>1，2&nbsp;<strong>网页可重用。<&#47;strong></p>
<p>举例说：A公司说我要用你的某个页面。那好我们约定2个key，<span style="line-height: 1.5;">一个key叫siteKey，通过它我知道你是A公司, 一个叫通信保密SecretKey，仅双方知道，通过它，我确认你真的是A公司。A公司在自己公司页面请求时加上siteKey+MD5(SecretKey), &nbsp;我一看&nbsp;这两个参数没错，然后我把网页及网页后面的服务器各类资源配置，一并送到A公司的页面上。来一百个公司，都是这样处理。<&#47;span></p>
<p>3，<strong>业务可分担<&#47;strong>。B公司来了，B说我不要页面，我们的页面比你的页面还漂亮，我现在的问题是后台响应慢，慢的原因数据库卡啦网络掉啦访问量并发量太高一堆， 我想要你能把我的后台变快。那好，告诉我请求有哪些，转到我的服务后台来<strong>。但是<&#47;strong><span style="line-height: 1.5;">没数据没业务逻辑，我两眼一抹黑啊。确实，<&#47;span><span style="line-height: 1.5;">这个问题绝不是一个简单方案能解决的问题。但是可以从一定的程度缓解，比如：如果瓶颈在后台的服务，我可以在分担一部分请求。你把你的业务处理分一部分过来，把处理结果同步给你，你仍然是你的数据源不受影响。<&#47;span></p>
<p>4，5，<strong>数据访问独立于业务<&#47;strong>。实际上B公司通过第三部解决问题的可能性很低。因为，大部分的问题来源，往往就在数据源的设计和系统间的紧密耦合。业务部分就那么点逻辑，性能上都犯不了什么大罪。怎么办？那就要到第四步，B公司放弃自己的数据存储逻辑，将自己的数据访问部分转到数据存取服务层5上面来。业务部分只负责实体调用增删改查方法。具体数据源的选择，sql语句，mongodb指令，redis指令，数据归档，执行，都在数据访问层实现。</p>
<p>6，7，8将是软件自己保证健壮，低成本运作。</p>
